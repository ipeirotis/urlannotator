{% extends 'main/project/project_base.html' %}

{% block classifier_active %}active{% endblock %}
{% block project_content %}
  <div class="row-fluid">
    <div class="span1">
      <h3>Classifier</h3>
    </div>
    <div class="span8">&nbsp;</div>
    <div class="span3" style="text-align:right">
      <a href="#" class="btn">Export Training Ready Data</a>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span2">
      <h4>Classifier performance</h4>
    </div>
    <div class="span7">&nbsp;</div>
    <div class="span3" style="text-align:right">
      <select>
        <option>04/19/2012-04/19/2012</option>
      </select>
    </div>
  </div>
  <div class="row-fluid" id="performanceGraph">
    Graph
  </div>
  <div class="row-fluid">
    <div class="span7">
      <h4>Test classifier</h4>
      To test the classifier you can input either URLs or text.
      <form method="POST" action="">
      <table id="classifier-test">
        <tbody>
            <tr>
                <td></td>
                <td>
                    <input id="radio-urls" type="radio" name="test-type" checked="checked" value="urls">URL(s)
                    <input id="radio-texts" type="radio" name="test-type" value="texts">Text(s)
                </td>
            </tr>
            <tr id="input-test-urls">
                <td>
                    Input test URL(s):
                </td>
                <td>
                    <textarea name="test-urls" cols="40" rows="5">Simple URL</textarea>
                </td>
            </tr>
            <tr class="input-test-texts" style="display:none;">
                <td>
                    Input Text:
                </td>
                <td>
                    <textarea name="test-texts" cols="40" rows="5"></textarea>
                </td>
            </tr>
            <tr class="input-test-texts" style="display:none;">
                <td></td>
                <td>
                    <button id="new-text-button" href="#" class="btn" style="width: 100%">+</button>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    {%csrf_token%}
                    <input type="submit" href="#" class="btn" value="Classify!">      
                </td>
            </tr>
        </tbody>
      </table>
      </form>
    </div>
    <div class="span5">
      <h4>Classifier statistics</h4>
      <table class="table">
        <thead></thead>
        <tbody>
          <tr><td>URLs collected</td><td>{{classifier_stats.count}}</td><td>-</td></tr>
          <tr><td>yes class records</td><td>{{classifier_stats.yes_labels.val}}</td><td>{{classifier_stats.yes_labels.perc}}%</td></tr>
          <tr><td>no class records</td><td>{{classifier_stats.no_labels.val}}</td><td>{{classifier_stats.no_labels.perc}}%</td></tr>
          <tr><td>broken class records</td><td>{{classifier_stats.broken_labels.val}}</td><td>{{classifier_stats.broken_labels.perc}}%</td></tr>
        </tbody>
      </table>
    </div>
  </div>
    {% if samples_pending or samples_created %}
      <h4>Classification Results</h4>
      <table class="table">
        <thead>
          <tr>
            <th style="width: 50px;">Preview</th>
            <th>URL</th>
            <th style="width: 50px;">Class</th>
            <th style="width: 130px;">Calculated Class Probability</th>
          </tr>
        </thead>
        <tbody>
          {% for sample in samples_pending %}
            <tr>
              <td>
                <a href=""><img style="width: 40px; height:40px" src=""></a>
              </td>
              <td>
                <a href="{{ sample.url }}">{{ sample.url }}</a>
              </td>
              <td>
                PENDING
              </td>
              <td>
                -
              </td>
            </tr>
          {% endfor %}
          {% for classified_sample in samples_created %}
            <tr>
              <td>
                <a href="{{ classified_sample.sample.screenshot }}"><img style="width: 40px; height:40px" src="{{ classified_sample.sample.screenshot }}"></a>
              </td>
              <td>
                <a href="{{ classified_sample.url }}">{{ classified_sample.url }}</a>
              </td>
              <td>
                {% if classified_sample.label == '' %}PENDING{%else%}{{ classified_sample.label }}{%endif%}
              </td>
              <td>
                {% if classified_sample.label == '' %}-{%else%}{{ classified_sample.label }}{%endif%}
              </td>
            </tr>
          {% endfor %}
        </tbody>  
      </table>
    {% endif %}
  
</div>
{% endblock %}

{% block javascript %}
{{ block.super }}
<script src="{{STATIC_URL}}js/highcharts.js" type="text/javascript"></script>
<script type="text/javascript">
$('#radio-urls').change(function(obj) {
        $('.input-test-texts').css('display', 'none');
        $('#input-test-urls').css('display', '');
    }
);
$('#radio-texts').change(function(obj) {
        $('#input-test-urls').css('display', 'none');
        $('.input-test-texts').css('display', '');
    }
);

var performanceGraph; // globally available
$(document).ready(function() {
      performanceGraph = new Highcharts.Chart({
         chart: {
            renderTo: 'performanceGraph',
            type: 'line',
            zoomType: 'x'
         },
         title: {
            text: 'Classifier performance'
         },
         xAxis: {
            type: 'datetime',
            maxZoom: 1 * 3600 * 1000, // an hour
         },
         yAxis: {
            title: {
              text: 'Performance'
            },
            showFirstLabel: false
         },
         series: [{
            showInLegend: true,
            name: 'TPM',
            color: '#FFAAFF',
            data: [{{performance_TPM|safe}}]
         },
         {
            showInLegend: true,
            name: 'NPM',
            color: '#AAAAFF',
            data: [{{performance_NPM|safe}}]
         },
         {
            showInLegend: true,
            name: 'AUC',
            color: '#AAFFAA',
            data: [{{performance_AUC|safe}}]
         }]
      });
   });
</script>
{% endblock %}

{% block css %}
{{ block.super }}
<style type="text/css">
table#classifier-test td:first-child{
    width: 120px;
    text-align: right;
    vertical-align: top;
    padding-right: 10px;
}

</style>
{% endblock %}
